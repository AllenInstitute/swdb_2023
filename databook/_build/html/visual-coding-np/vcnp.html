
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Brain Observatory - Neuropixels &#8212; SWDB 2023 DataBook</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Glossary" href="../glossary.html" />
    <link rel="prev" title="Cross session data" href="../visual-coding-2p/vc2p-cross-session-data.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">SWDB 2023 DataBook</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Summer Workshop on the Dynamic Brain Databook
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../background/background.html">
   Background
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../background/anatomy.html">
     Anatomy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../background/transgenic-tools.html">
     Transgenic tools
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../background/Two-photon-calcium-imaging.html">
     Two photon calcium imaging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../background/Neuropixels-electrophysiology.html">
     Neuropixels electrophysiology
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../background/Ophys-ephys-comparison.html">
     Ophys ephys comparison
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../visual-coding-2p/vc2p-background.html">
   Visual Coding 2-photon
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../visual-coding-2p/vc2p-dataset.html">
     Dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../visual-coding-2p/vc2p-session-data.html">
     Getting data from a session
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../visual-coding-2p/vc2p-stimuli.html">
     Visual stimuli
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../visual-coding-2p/vc2p-cross-session-data.html">
     Cross session data
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Brain Observatory - Neuropixels
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../glossary.html">
   Glossary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../bibliography.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/visual-coding-np/vcnp.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/executablebooks/jupyter-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fvisual-coding-np/vcnp.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/visual-coding-np/vcnp.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download notebook file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        <a href="../_sources/visual-coding-np/vcnp.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exploring-available-sessions-of-the-dataset">
   Exploring available sessions of the dataset
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-session-object">
   The session object
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#units">
   Units
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spike-times">
     Spike Times
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#unit-waveforms">
     Unit waveforms
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stimuli">
   Stimuli
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stimulus-responses">
   Stimulus responses
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#xarray">
     Xarray
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#local-field-potential-lfp">
   Local Field Potential (LFP)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#other-resources">
   Other resources
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Brain Observatory - Neuropixels</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exploring-available-sessions-of-the-dataset">
   Exploring available sessions of the dataset
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-session-object">
   The session object
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#units">
   Units
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spike-times">
     Spike Times
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#unit-waveforms">
     Unit waveforms
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stimuli">
   Stimuli
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stimulus-responses">
   Stimulus responses
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#xarray">
     Xarray
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#local-field-potential-lfp">
   Local Field Potential (LFP)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#other-resources">
   Other resources
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="brain-observatory-neuropixels">
<h1>Brain Observatory - Neuropixels<a class="headerlink" href="#brain-observatory-neuropixels" title="Permalink to this headline">#</a></h1>
<p>This notebook will introduce you to the Neuropixel dataset and SDK functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<p>The main entry point is the <code class="docutils literal notranslate"><span class="pre">EcephyProjectCache</span></code> class. This class is
responsible for downloading any requested data or metadata as needed and storing
it in well known locations. For this workshop, all of the data has been
preloaded onto the hard drives you have received, and is available on AWS.</p>
<p>We begin by importing the <code class="docutils literal notranslate"><span class="pre">EcephysProjectCache</span></code> class and instantiating it.</p>
<p><code class="docutils literal notranslate"><span class="pre">manifest_path</span></code> is a path to the manifest file. We will use the manifest file
preloaded onto your Workshop hard drives. Make sure that <code class="docutils literal notranslate"><span class="pre">drive_path</span></code> is set
correctly for your platform. (See the first cell in this notebook.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">allensdk.brain_observatory.ecephys.ecephys_project_cache</span> <span class="kn">import</span> <span class="n">EcephysProjectCache</span>
<span class="kn">from</span> <span class="nn">allensdk.brain_observatory.ecephys</span> <span class="kn">import</span> <span class="n">ecephys_session</span>

<span class="n">cache</span> <span class="o">=</span> <span class="n">EcephysProjectCache</span><span class="o">.</span><span class="n">from_warehouse</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="exploring-available-sessions-of-the-dataset">
<h2>Exploring available sessions of the dataset<a class="headerlink" href="#exploring-available-sessions-of-the-dataset" title="Permalink to this headline">#</a></h2>
<p>:::{admonition} Example: Get information about what’s in the Neuropixels dataset</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">get_sessions</span></code> function from <code class="docutils literal notranslate"><span class="pre">EcephysProjectCache</span></code> to retrieve a
dataframe of all the available sessions. What information does this dataframe
contain?</p>
<ul class="simple">
<li><p>How many sessions are there in the dataset?</p></li>
<li><p>What is the average number of units in an experiment? The max number? The minimum?</p></li>
<li><p>What are the different genotypes that were used in these experiments? How many sessions per genotype?</p></li>
<li><p>What are all the brain structures that data has been collected from?
:::</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sessions</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get_session_table</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sessions</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>published_at</th>
      <th>specimen_id</th>
      <th>session_type</th>
      <th>age_in_days</th>
      <th>sex</th>
      <th>full_genotype</th>
      <th>unit_count</th>
      <th>channel_count</th>
      <th>probe_count</th>
      <th>ecephys_structure_acronyms</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>715093703</th>
      <td>2019-10-03T00:00:00Z</td>
      <td>699733581</td>
      <td>brain_observatory_1.1</td>
      <td>118.0</td>
      <td>M</td>
      <td>Sst-IRES-Cre/wt;Ai32(RCL-ChR2(H134R)_EYFP)/wt</td>
      <td>884</td>
      <td>2219</td>
      <td>6</td>
      <td>[CA1, VISrl, nan, PO, LP, LGd, CA3, DG, VISl, ...</td>
    </tr>
    <tr>
      <th>719161530</th>
      <td>2019-10-03T00:00:00Z</td>
      <td>703279284</td>
      <td>brain_observatory_1.1</td>
      <td>122.0</td>
      <td>M</td>
      <td>Sst-IRES-Cre/wt;Ai32(RCL-ChR2(H134R)_EYFP)/wt</td>
      <td>755</td>
      <td>2214</td>
      <td>6</td>
      <td>[TH, Eth, APN, POL, LP, DG, CA1, VISpm, nan, N...</td>
    </tr>
    <tr>
      <th>721123822</th>
      <td>2019-10-03T00:00:00Z</td>
      <td>707296982</td>
      <td>brain_observatory_1.1</td>
      <td>125.0</td>
      <td>M</td>
      <td>Pvalb-IRES-Cre/wt;Ai32(RCL-ChR2(H134R)_EYFP)/wt</td>
      <td>444</td>
      <td>2229</td>
      <td>6</td>
      <td>[MB, SCig, PPT, NOT, DG, CA1, VISam, nan, LP, ...</td>
    </tr>
    <tr>
      <th>732592105</th>
      <td>2019-10-03T00:00:00Z</td>
      <td>717038288</td>
      <td>brain_observatory_1.1</td>
      <td>100.0</td>
      <td>M</td>
      <td>wt/wt</td>
      <td>824</td>
      <td>1847</td>
      <td>5</td>
      <td>[grey, VISpm, nan, VISp, VISl, VISal, VISrl]</td>
    </tr>
    <tr>
      <th>737581020</th>
      <td>2019-10-03T00:00:00Z</td>
      <td>718643567</td>
      <td>brain_observatory_1.1</td>
      <td>108.0</td>
      <td>M</td>
      <td>wt/wt</td>
      <td>568</td>
      <td>2218</td>
      <td>6</td>
      <td>[grey, VISmma, nan, VISpm, VISp, VISl, VISrl]</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>How many sessions are available?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sessions</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>58
</pre></div>
</div>
</div>
</div>
<p>What’s the average number of units in a session? The max? The min?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">sessions</span><span class="o">.</span><span class="n">unit_count</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sessions</span><span class="o">.</span><span class="n">unit_count</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sessions</span><span class="o">.</span><span class="n">unit_count</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>689.8275862068965
1005
415
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sessions</span><span class="o">.</span><span class="n">unit_count</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Unit count&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;# sessions&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;# sessions&#39;)
</pre></div>
</div>
<img alt="../_images/vcnp_11_1.png" src="../_images/vcnp_11_1.png" />
</div>
</div>
<p>What are the different genotypes that were used for this dataset? How many
sessions per genotype are available?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sessions</span><span class="o">.</span><span class="n">full_genotype</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>wt/wt                                              30
Sst-IRES-Cre/wt;Ai32(RCL-ChR2(H134R)_EYFP)/wt      12
Pvalb-IRES-Cre/wt;Ai32(RCL-ChR2(H134R)_EYFP)/wt     8
Vip-IRES-Cre/wt;Ai32(RCL-ChR2(H134R)_EYFP)/wt       8
Name: full_genotype, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>What are the different session types? How many sessions per type?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sessions</span><span class="o">.</span><span class="n">session_type</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>brain_observatory_1.1      32
functional_connectivity    26
Name: session_type, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>What are all the structures that data has been collected from?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_areas</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">sessions</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">ecephys_structure_acronyms</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_areas</span><span class="p">:</span>
            <span class="n">all_areas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">all_areas</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;CA1&#39;, &#39;VISrl&#39;, nan, &#39;PO&#39;, &#39;LP&#39;, &#39;LGd&#39;, &#39;CA3&#39;, &#39;DG&#39;, &#39;VISl&#39;, &#39;PoT&#39;, &#39;VISp&#39;, &#39;grey&#39;, &#39;VISpm&#39;, &#39;APN&#39;, &#39;MB&#39;, &#39;VISam&#39;, &#39;TH&#39;, &#39;Eth&#39;, &#39;POL&#39;, &#39;NOT&#39;, &#39;SUB&#39;, &#39;VL&#39;, &#39;CA2&#39;, &#39;VPM&#39;, &#39;VISal&#39;, &#39;SCig&#39;, &#39;PPT&#39;, &#39;VIS&#39;, &#39;ProS&#39;, &#39;LGv&#39;, &#39;HPF&#39;, &#39;VISmma&#39;, &#39;PP&#39;, &#39;PIL&#39;, &#39;MGv&#39;, &#39;VPL&#39;, &#39;IGL&#39;, &#39;SGN&#39;, &#39;IntG&#39;, &#39;LD&#39;, &#39;MGm&#39;, &#39;MGd&#39;, &#39;POST&#39;, &#39;MRN&#39;, &#39;VISli&#39;, &#39;OP&#39;, &#39;ZI&#39;, &#39;VISmmp&#39;, &#39;PF&#39;, &#39;LT&#39;, &#39;RPF&#39;, &#39;PRE&#39;, &#39;SCiw&#39;, &#39;CP&#39;, &#39;COAa&#39;, &#39;RT&#39;, &#39;SCop&#39;, &#39;SCsg&#39;, &#39;SCzo&#39;, &#39;COApm&#39;, &#39;OLF&#39;, &#39;BMAa&#39;]
</pre></div>
</div>
</div>
</div>
<p>To get more information about these structures, visit
<a class="reference external" href="http://atlas.brain-map.org/atlas?atlas=602630314">our reference atlas web app</a>.</p>
<p>How many sessions have data from VISp?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">count</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">sessions</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="k">if</span> <span class="s1">&#39;VISp&#39;</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">ecephys_structure_acronyms</span><span class="p">:</span>
        <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>56
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-session-object">
<h2>The session object<a class="headerlink" href="#the-session-object" title="Permalink to this headline">#</a></h2>
<p>The session object contains all the data and metadata for a single experiment
session, including spike times, stimulus information, unit waveforms and derived
metrics, LFP, and the mouse’s running speed.</p>
<p>The session object is accessed using <code class="docutils literal notranslate"><span class="pre">cache.get_session_data(session_id)</span></code></p>
<p>:::{note}
Experiment data is loaded upon initialization of the class. Some data can be
accessed directly as an attribute of the class, others by using ‘get’ functions.
:::</p>
<p>:::{admonition} Example: Select a session
Let’s pick one session to examine in greater detail. Select a
<code class="docutils literal notranslate"><span class="pre">brain_observatory_1.1</span></code> session. Feel free to use other metadata to select one
session and get the session_id (the index).
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">session_id</span> <span class="o">=</span> <span class="n">sessions</span><span class="p">[(</span><span class="n">sessions</span><span class="o">.</span><span class="n">unit_count</span><span class="o">&gt;</span><span class="mi">900</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">sessions</span><span class="o">.</span><span class="n">session_type</span><span class="o">==</span><span class="s1">&#39;brain_observatory_1.1&#39;</span><span class="p">)</span>
                      <span class="o">&amp;</span><span class="p">(</span><span class="n">sessions</span><span class="o">.</span><span class="n">full_genotype</span><span class="o">==</span><span class="s1">&#39;wt/wt&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>750332458
</pre></div>
</div>
</div>
</div>
<p>Which areas were recorded from in this session?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sessions</span><span class="o">.</span><span class="n">ecephys_structure_acronyms</span><span class="p">[</span><span class="n">session_id</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;grey&#39;, &#39;VISrl&#39;, nan, &#39;VISal&#39;, &#39;IntG&#39;, &#39;IGL&#39;, &#39;LGd&#39;, &#39;CA3&#39;, &#39;DG&#39;,
       &#39;CA1&#39;, &#39;VISl&#39;, &#39;VISp&#39;, &#39;VISpm&#39;, &#39;VISam&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>:::{admonition} Example: Get the data for this session.</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">get_session_data</span></code> function of the cache to get the session object for
this session. This object contains the data that is stored in the NWB file.
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get_session_data</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="units">
<h2>Units<a class="headerlink" href="#units" title="Permalink to this headline">#</a></h2>
<p>The primary data in this dataset is the recorded acrtivity of isolated units. A
number of metrics are used to isolate units through spike sorting, and these
metrics can be used to access how well isolated they are and the quality of
each unit. The <code class="docutils literal notranslate"><span class="pre">units</span></code> dataframe provides many of these metrics, as well as
parameterization of the waveform for each unit that passed initial QC,
including</p>
<ul class="simple">
<li><p><strong>firing rate:</strong> mean spike rate during the entire session</p></li>
<li><p><strong>presence ratio:</strong> fraction of session when spikes are present</p></li>
<li><p><strong>ISI violations:</strong> rate of refractory period violations</p></li>
<li><p><strong>Isolation distances:</strong> distance to nearest cluster in Mihalanobis space</p></li>
<li><p><strong>d’:</strong> classification accuracy based on LDA</p></li>
<li><p><strong>SNR:</strong> signal to noise ratio</p></li>
<li><p><strong>Maximum drift:</strong> Maximum change in spike depth during recording</p></li>
<li><p><strong>Cumulative drift:</strong> Cumulative change in spike depth during recording</p></li>
</ul>
<p><strong>1D Waveform features:</strong></p>
<img alt="../_images/spike_waveform.png" id="spike-waveform" src="../_images/spike_waveform.png" />
<p>For more information on these:</p>
<p>https://github.com/AllenInstitute/ecephys_spike_sorting/tree/master/ecephys_spike_sorting/modules/quality_metrics
https://github.com/AllenInstitute/ecephys_spike_sorting/tree/master/ecephys_spike_sorting/modules/mean_waveforms</p>
<p>:::{admonition} Example: Units
Get the <code class="docutils literal notranslate"><span class="pre">units</span></code> dataframe for this session.</p>
<p>What the the metrics? (i.e. what are the columns for the dataframe?</p>
<p>How many units are there? How many units per structure?
:::</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>waveform_PT_ratio</th>
      <th>waveform_amplitude</th>
      <th>amplitude_cutoff</th>
      <th>cluster_id</th>
      <th>cumulative_drift</th>
      <th>d_prime</th>
      <th>firing_rate</th>
      <th>isi_violations</th>
      <th>isolation_distance</th>
      <th>L_ratio</th>
      <th>...</th>
      <th>ecephys_structure_id</th>
      <th>ecephys_structure_acronym</th>
      <th>anterior_posterior_ccf_coordinate</th>
      <th>dorsal_ventral_ccf_coordinate</th>
      <th>left_right_ccf_coordinate</th>
      <th>probe_description</th>
      <th>location</th>
      <th>probe_sampling_rate</th>
      <th>probe_lfp_sampling_rate</th>
      <th>probe_has_lfp_data</th>
    </tr>
    <tr>
      <th>unit_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>951817231</th>
      <td>0.293351</td>
      <td>101.641410</td>
      <td>0.001248</td>
      <td>8</td>
      <td>392.48</td>
      <td>6.461795</td>
      <td>15.773666</td>
      <td>0.020093</td>
      <td>147.423046</td>
      <td>0.000259</td>
      <td>...</td>
      <td>8.0</td>
      <td>grey</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>probeA</td>
      <td>See electrode locations</td>
      <td>29999.968724</td>
      <td>1249.998697</td>
      <td>True</td>
    </tr>
    <tr>
      <th>951817222</th>
      <td>1.427508</td>
      <td>74.654970</td>
      <td>0.032535</td>
      <td>7</td>
      <td>948.33</td>
      <td>5.638511</td>
      <td>6.423025</td>
      <td>0.007457</td>
      <td>95.080849</td>
      <td>0.000727</td>
      <td>...</td>
      <td>8.0</td>
      <td>grey</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>probeA</td>
      <td>See electrode locations</td>
      <td>29999.968724</td>
      <td>1249.998697</td>
      <td>True</td>
    </tr>
    <tr>
      <th>951817272</th>
      <td>0.240866</td>
      <td>182.350545</td>
      <td>0.000218</td>
      <td>13</td>
      <td>578.80</td>
      <td>4.865528</td>
      <td>25.891454</td>
      <td>0.002123</td>
      <td>121.137882</td>
      <td>0.017477</td>
      <td>...</td>
      <td>8.0</td>
      <td>grey</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>probeA</td>
      <td>See electrode locations</td>
      <td>29999.968724</td>
      <td>1249.998697</td>
      <td>True</td>
    </tr>
    <tr>
      <th>951817282</th>
      <td>0.650177</td>
      <td>183.182025</td>
      <td>0.000223</td>
      <td>14</td>
      <td>545.47</td>
      <td>4.402664</td>
      <td>9.177656</td>
      <td>0.001370</td>
      <td>59.655811</td>
      <td>0.025102</td>
      <td>...</td>
      <td>8.0</td>
      <td>grey</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>probeA</td>
      <td>See electrode locations</td>
      <td>29999.968724</td>
      <td>1249.998697</td>
      <td>True</td>
    </tr>
    <tr>
      <th>951817316</th>
      <td>0.387017</td>
      <td>71.279130</td>
      <td>0.059431</td>
      <td>18</td>
      <td>446.09</td>
      <td>3.582546</td>
      <td>10.277127</td>
      <td>0.050247</td>
      <td>56.080395</td>
      <td>0.021113</td>
      <td>...</td>
      <td>8.0</td>
      <td>grey</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>probeA</td>
      <td>See electrode locations</td>
      <td>29999.968724</td>
      <td>1249.998697</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 40 columns</p>
</div></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;waveform_PT_ratio&#39;, &#39;waveform_amplitude&#39;, &#39;amplitude_cutoff&#39;,
       &#39;cluster_id&#39;, &#39;cumulative_drift&#39;, &#39;d_prime&#39;, &#39;firing_rate&#39;,
       &#39;isi_violations&#39;, &#39;isolation_distance&#39;, &#39;L_ratio&#39;, &#39;local_index&#39;,
       &#39;max_drift&#39;, &#39;nn_hit_rate&#39;, &#39;nn_miss_rate&#39;, &#39;peak_channel_id&#39;,
       &#39;presence_ratio&#39;, &#39;waveform_recovery_slope&#39;,
       &#39;waveform_repolarization_slope&#39;, &#39;silhouette_score&#39;, &#39;snr&#39;,
       &#39;waveform_spread&#39;, &#39;waveform_velocity_above&#39;, &#39;waveform_velocity_below&#39;,
       &#39;waveform_duration&#39;, &#39;filtering&#39;, &#39;probe_channel_number&#39;,
       &#39;probe_horizontal_position&#39;, &#39;probe_id&#39;, &#39;probe_vertical_position&#39;,
       &#39;structure_acronym&#39;, &#39;ecephys_structure_id&#39;,
       &#39;ecephys_structure_acronym&#39;, &#39;anterior_posterior_ccf_coordinate&#39;,
       &#39;dorsal_ventral_ccf_coordinate&#39;, &#39;left_right_ccf_coordinate&#39;,
       &#39;probe_description&#39;, &#39;location&#39;, &#39;probe_sampling_rate&#39;,
       &#39;probe_lfp_sampling_rate&#39;, &#39;probe_has_lfp_data&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p>How many units are in this session?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>902
</pre></div>
</div>
</div>
</div>
<p>Which areas (structures) are they from?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">ecephys_structure_acronym</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;grey&#39; &#39;VISam&#39; &#39;VISpm&#39; &#39;VISp&#39; &#39;IntG&#39; &#39;IGL&#39; &#39;LGd&#39; &#39;CA3&#39; &#39;DG&#39; &#39;CA1&#39; &#39;VISl&#39;
 &#39;VISal&#39; &#39;VISrl&#39;]
</pre></div>
</div>
</div>
</div>
<p>How many units per area are there?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">ecephys_structure_acronym</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>grey     558
VISal     71
VISp      63
VISam     60
VISrl     44
VISl      38
VISpm     19
CA1       16
CA3       15
DG         7
IGL        5
LGd        4
IntG       2
Name: ecephys_structure_acronym, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>:::{admonition} Example: Select ‘good’ units
A default is to include units that have a SNR greater than 1 and ISI violations
less than 0.5 Plot a histogram of the values for each of these metrics? How
many units meet these criteria? How many per structure?
:::</p>
<p>plot a histogram for SNR</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">snr</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/vcnp_37_0.png" src="../_images/vcnp_37_0.png" />
</div>
</div>
<p>plot a histogram for ISI violations</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">isi_violations</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/vcnp_39_0.png" src="../_images/vcnp_39_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">good_units</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="p">[(</span><span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">snr</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">isi_violations</span><span class="o">&lt;</span><span class="mf">0.5</span><span class="p">)]</span>
<span class="nb">len</span><span class="p">(</span><span class="n">good_units</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>868
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">good_units</span><span class="o">.</span><span class="n">ecephys_structure_acronym</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>grey     548
VISal     64
VISp      62
VISam     60
VISrl     37
VISl      34
VISpm     18
CA3       15
CA1       15
DG         7
IGL        4
LGd        3
IntG       1
Name: ecephys_structure_acronym, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>:::{admonition} Example: Compare the firing rate of good units in different structures
Make a violinplot of the overall firing rates of units across structures.
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;firing_rate&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;ecephys_structure_acronym&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">good_units</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;ecephys_structure_acronym&#39;, ylabel=&#39;firing_rate&#39;&gt;
</pre></div>
</div>
<img alt="../_images/vcnp_44_1.png" src="../_images/vcnp_44_1.png" />
</div>
</div>
<p>:::{admonition} Example: Plot the location of the units on the probe
Color each structure a different color. What do you learn about the vertical position values?
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="c1"># restrict to one probe</span>
<span class="n">probe_id</span> <span class="o">=</span> <span class="n">good_units</span><span class="o">.</span><span class="n">probe_id</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">probe_units</span> <span class="o">=</span> <span class="n">good_units</span><span class="p">[</span><span class="n">good_units</span><span class="o">.</span><span class="n">probe_id</span><span class="o">==</span><span class="n">probe_id</span><span class="p">]</span>
<span class="k">for</span> <span class="n">structure</span> <span class="ow">in</span> <span class="n">good_units</span><span class="o">.</span><span class="n">ecephys_structure_acronym</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
        <span class="n">probe_units</span><span class="p">[</span><span class="n">probe_units</span><span class="o">.</span><span class="n">ecephys_structure_acronym</span><span class="o">==</span><span class="n">structure</span><span class="p">]</span><span class="o">.</span><span class="n">probe_vertical_position</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3200</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="n">structure</span>
    <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Probe vertical position (mm)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Unit count&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/vcnp_46_0.png" src="../_images/vcnp_46_0.png" />
</div>
</div>
<section id="spike-times">
<h3>Spike Times<a class="headerlink" href="#spike-times" title="Permalink to this headline">#</a></h3>
<p>The primary data in this dataset is the recorded acrtivity of isolated units.
The <code class="docutils literal notranslate"><span class="pre">spike</span> <span class="pre">times</span></code> is a dictionary of spike times for each units in the session.</p>
<p>:::{admonition} Example: Spike Times
Next let’s find the <code class="docutils literal notranslate"><span class="pre">spike_times</span></code> for these units.
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spike_times</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">spike_times</span>
</pre></div>
</div>
</div>
</div>
<p>What type of object is this?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">spike_times</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict
</pre></div>
</div>
</div>
</div>
<p>How many items does it include?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">spike_times</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>902
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>902
</pre></div>
</div>
</div>
</div>
<p>What are the keys for this object?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">spike_times</span><span class="o">.</span><span class="n">keys</span><span class="p">())[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[951817566, 951817557, 951818568, 951818561, 951818553]
</pre></div>
</div>
</div>
</div>
<p>These keys are unit ids. Use the unit_id for the first unit to get the spike times for that unit. How many spikes does it have in the entire session?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spike_times</span><span class="p">[</span><span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([3.79596714e+00, 3.81646716e+00, 3.84250052e+00, ...,
       9.75020103e+03, 9.75023709e+03, 9.75027469e+03])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spike_times</span><span class="p">[</span><span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>153738
</pre></div>
</div>
</div>
</div>
<p>:::{admonition} Example: Get the spike times for the units in V1
Use the units dataframe to identify units in ‘VISp’ and use the spike_times to
get their spikes. Start just getting the spike times for the first unit
identified this way. Plot a raster plot of the spikes during the first 5
minutes (300 seconds) of the experiment.
:::</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">ecephys_structure_acronym</span><span class="o">==</span><span class="s1">&#39;VISp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>waveform_PT_ratio</th>
      <th>waveform_amplitude</th>
      <th>amplitude_cutoff</th>
      <th>cluster_id</th>
      <th>cumulative_drift</th>
      <th>d_prime</th>
      <th>firing_rate</th>
      <th>isi_violations</th>
      <th>isolation_distance</th>
      <th>L_ratio</th>
      <th>...</th>
      <th>ecephys_structure_id</th>
      <th>ecephys_structure_acronym</th>
      <th>anterior_posterior_ccf_coordinate</th>
      <th>dorsal_ventral_ccf_coordinate</th>
      <th>left_right_ccf_coordinate</th>
      <th>probe_description</th>
      <th>location</th>
      <th>probe_sampling_rate</th>
      <th>probe_lfp_sampling_rate</th>
      <th>probe_has_lfp_data</th>
    </tr>
    <tr>
      <th>unit_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>951814973</th>
      <td>0.599534</td>
      <td>26.217945</td>
      <td>0.014322</td>
      <td>361</td>
      <td>345.26</td>
      <td>2.927932</td>
      <td>1.503416</td>
      <td>0.410801</td>
      <td>61.132264</td>
      <td>0.001457</td>
      <td>...</td>
      <td>385.0</td>
      <td>VISp</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>probeC</td>
      <td>See electrode locations</td>
      <td>29999.996461</td>
      <td>1249.999853</td>
      <td>True</td>
    </tr>
    <tr>
      <th>951814989</th>
      <td>0.366990</td>
      <td>43.292340</td>
      <td>0.026720</td>
      <td>363</td>
      <td>386.49</td>
      <td>5.082127</td>
      <td>1.885503</td>
      <td>0.000000</td>
      <td>89.588334</td>
      <td>0.001691</td>
      <td>...</td>
      <td>385.0</td>
      <td>VISp</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>probeC</td>
      <td>See electrode locations</td>
      <td>29999.996461</td>
      <td>1249.999853</td>
      <td>True</td>
    </tr>
    <tr>
      <th>951816812</th>
      <td>0.394103</td>
      <td>103.924470</td>
      <td>0.002891</td>
      <td>561</td>
      <td>146.34</td>
      <td>4.708563</td>
      <td>2.415644</td>
      <td>0.046132</td>
      <td>80.151626</td>
      <td>0.000185</td>
      <td>...</td>
      <td>385.0</td>
      <td>VISp</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>probeC</td>
      <td>See electrode locations</td>
      <td>29999.996461</td>
      <td>1249.999853</td>
      <td>True</td>
    </tr>
    <tr>
      <th>951815078</th>
      <td>0.329370</td>
      <td>111.679035</td>
      <td>0.051784</td>
      <td>373</td>
      <td>165.93</td>
      <td>3.799649</td>
      <td>4.062188</td>
      <td>0.100211</td>
      <td>55.356604</td>
      <td>0.010204</td>
      <td>...</td>
      <td>385.0</td>
      <td>VISp</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>probeC</td>
      <td>See electrode locations</td>
      <td>29999.996461</td>
      <td>1249.999853</td>
      <td>True</td>
    </tr>
    <tr>
      <th>951815150</th>
      <td>0.526429</td>
      <td>232.830975</td>
      <td>0.001259</td>
      <td>382</td>
      <td>302.18</td>
      <td>6.045597</td>
      <td>0.516495</td>
      <td>0.000000</td>
      <td>80.501412</td>
      <td>0.000006</td>
      <td>...</td>
      <td>385.0</td>
      <td>VISp</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>probeC</td>
      <td>See electrode locations</td>
      <td>29999.996461</td>
      <td>1249.999853</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 40 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unit_id</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">ecephys_structure_acronym</span><span class="o">==</span><span class="s1">&#39;VISp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spikes</span> <span class="o">=</span> <span class="n">spike_times</span><span class="p">[</span><span class="n">unit_id</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spikes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">spikes</span><span class="p">)),</span> <span class="s1">&#39;|&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 0, &#39;Time (s)&#39;)
</pre></div>
</div>
<img alt="../_images/vcnp_62_1.png" src="../_images/vcnp_62_1.png" />
</div>
</div>
<p>:::{admonition} Example: Plot the firing rate for this units across the entire session
A raster plot won’t work for visualizing the activity across the entire session
as there are too many spikes! Instead, bin the activity in 1 second bins.
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numbins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">spikes</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
<span class="n">binned_spikes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">numbins</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numbins</span><span class="p">):</span>
    <span class="n">binned_spikes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spikes</span><span class="p">[(</span><span class="n">spikes</span><span class="o">&gt;</span><span class="n">i</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">spikes</span><span class="o">&lt;</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">binned_spikes</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;FR (Hz)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;FR (Hz)&#39;)
</pre></div>
</div>
<img alt="../_images/vcnp_65_1.png" src="../_images/vcnp_65_1.png" />
</div>
</div>
<p>:::{admonition} Example: Plot firing rates for units in V1
Now let’s do this for up to 50 units in V1. Make an array of the binned activity of all units in V1 called ‘v1_binned’. We’ll use this again later.
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v1_units</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">ecephys_structure_acronym</span><span class="o">==</span><span class="s1">&#39;VISp&#39;</span><span class="p">]</span>
<span class="n">numunits</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">v1_units</span><span class="p">)</span>
<span class="k">if</span> <span class="n">numunits</span><span class="o">&gt;</span><span class="mi">50</span><span class="p">:</span>
    <span class="n">numunits</span><span class="o">=</span><span class="mi">50</span>
<span class="n">v1_binned</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">numunits</span><span class="p">,</span> <span class="n">numbins</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numunits</span><span class="p">):</span>
    <span class="n">unit_id</span> <span class="o">=</span> <span class="n">v1_units</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">spikes</span> <span class="o">=</span> <span class="n">spike_times</span><span class="p">[</span><span class="n">unit_id</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numbins</span><span class="p">):</span>
        <span class="n">v1_binned</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spikes</span><span class="p">[(</span><span class="n">spikes</span><span class="o">&gt;</span><span class="n">j</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">spikes</span><span class="o">&lt;</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<p>Plot the activity of all the units, one above the other</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numunits</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">v1_binned</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">/</span><span class="mf">30.</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/vcnp_69_0.png" src="../_images/vcnp_69_0.png" />
</div>
</div>
</section>
<section id="unit-waveforms">
<h3>Unit waveforms<a class="headerlink" href="#unit-waveforms" title="Permalink to this headline">#</a></h3>
<p>For each unit, the average action potential waveform has been recorded from each
channel of the probe. This is contained in the <code class="docutils literal notranslate"><span class="pre">mean_waveforms</span></code> object. This is
the characteristic pattern that distinguishes each unit in spike sorting, and it
can also help inform us regarding differences between cell types.</p>
<p>We will use this in conjuction with the <code class="docutils literal notranslate"><span class="pre">channel_structure_intervals</span></code> function
which tells us where each channel is located in the brain. This will let us get
a feel for the spatial extent of the extracellular action potential waveforms in
relation to specific structures.</p>
<p>:::{admonition} Example: Unit waveforms
Get the waveform for one unit.
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">waveforms</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">mean_waveforms</span>
</pre></div>
</div>
</div>
</div>
<p>What type of object is this?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">waveforms</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict
</pre></div>
</div>
</div>
</div>
<p>What are the keys?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">waveforms</span><span class="o">.</span><span class="n">keys</span><span class="p">())[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[951817566, 951817557, 951818568, 951818561, 951818553]
</pre></div>
</div>
</div>
</div>
<p>Get the waveform for one unit</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unit</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">400</span><span class="p">]</span>
<span class="n">wf</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">mean_waveforms</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>What type of object is this? What is its shape?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">wf</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>xarray.core.dataarray.DataArray
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wf</span><span class="o">.</span><span class="n">coords</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Coordinates:
  * channel_id  (channel_id) int64 850176026 850176028 ... 850176790 850176792
  * time        (time) float64 0.0 3.333e-05 6.667e-05 ... 0.002667 0.0027
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wf</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(373, 82)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time steps&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Channel #&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Channel #&#39;)
</pre></div>
</div>
<img alt="../_images/vcnp_82_1.png" src="../_images/vcnp_82_1.png" />
</div>
</div>
<p>:::{admonition} Example: Unit waveforms
Use the <code class="docutils literal notranslate"><span class="pre">channel_structure_intervals</span></code> to get information about where each
channel is located.</p>
<p>We need to pass this function a list of channel ids, and it will identify
channels that mark boundaries between identified brain regions.</p>
<p>We can use this information to add some context to our visualization.
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pass in the list of channels from the waveforms data</span>
<span class="n">ecephys_structure_acronyms</span><span class="p">,</span> <span class="n">intervals</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">channel_structure_intervals</span><span class="p">(</span><span class="n">wf</span><span class="o">.</span><span class="n">channel_id</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ecephys_structure_acronyms</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">intervals</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;grey&#39; &#39;VISp&#39; nan]
[  0 204 292 373]
</pre></div>
</div>
</div>
</div>
<p>Place tick marks at the interval boundaries, and labels at the interval midpoints.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time (s)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">intervals</span><span class="p">)</span>
<span class="c1"># construct a list of midpoints by averaging adjacent endpoints</span>
<span class="n">interval_midpoints</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">aa</span> <span class="o">+</span> <span class="n">bb</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">aa</span><span class="p">,</span> <span class="n">bb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">intervals</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">intervals</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">interval_midpoints</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ecephys_structure_acronyms</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/vcnp_86_0.png" src="../_images/vcnp_86_0.png" />
</div>
</div>
<p>Let’s see if this matches the structure information saved in the units table:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">unit</span><span class="p">,</span> <span class="s2">&quot;ecephys_structure_acronym&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;grey&#39;
</pre></div>
</div>
</div>
</div>
<p>:::{admonition} Example: Plot the mean waveform for the peak channel for each unit in the dentate gyrus (DG)
Start by plotting the mean waveform for the peak channel for the unit we just looked at.
Then do this for all the units in DG, making a heatmap of these waveforms
:::</p>
<p>Find the peak channel for this unit, and plot the mean waveform for just that channel</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">channel_id</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">unit</span><span class="p">,</span> <span class="s1">&#39;peak_channel_id&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">channel_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>850176126
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wf</span><span class="o">.</span><span class="n">loc</span><span class="p">[{</span><span class="s2">&quot;channel_id&quot;</span><span class="p">:</span> <span class="n">channel_id</span><span class="p">}])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7fe8e0121fd0&gt;]
</pre></div>
</div>
<img alt="../_images/vcnp_91_1.png" src="../_images/vcnp_91_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">th_unit_ids</span> <span class="o">=</span> <span class="n">good_units</span><span class="p">[</span><span class="n">good_units</span><span class="o">.</span><span class="n">ecephys_structure_acronym</span><span class="o">==</span><span class="s2">&quot;DG&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>

<span class="n">peak_waveforms</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">unit_id</span> <span class="ow">in</span> <span class="n">th_unit_ids</span><span class="p">:</span>

    <span class="n">peak_ch</span> <span class="o">=</span> <span class="n">good_units</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">unit_id</span><span class="p">,</span> <span class="s2">&quot;peak_channel_id&quot;</span><span class="p">]</span>
    <span class="n">unit_mean_waveforms</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">mean_waveforms</span><span class="p">[</span><span class="n">unit_id</span><span class="p">]</span>

    <span class="n">peak_waveforms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unit_mean_waveforms</span><span class="o">.</span><span class="n">loc</span><span class="p">[{</span><span class="s2">&quot;channel_id&quot;</span><span class="p">:</span> <span class="n">peak_ch</span><span class="p">}])</span>


<span class="n">time_domain</span> <span class="o">=</span> <span class="n">unit_mean_waveforms</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>

<span class="n">peak_waveforms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">peak_waveforms</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">peak_waveforms</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7fe9a60d5bb0&gt;
</pre></div>
</div>
<img alt="../_images/vcnp_92_1.png" src="../_images/vcnp_92_1.png" />
</div>
</div>
</section>
</section>
<section id="stimuli">
<h2>Stimuli<a class="headerlink" href="#stimuli" title="Permalink to this headline">#</a></h2>
<p>A variety of visual stimuli were presented throughout the recording session, and the session object contains detailed information about what stimuli were presented when.</p>
<p>:::{admonition} Example: Stimulus
What stimuli were presented in this session? Find the <code class="docutils literal notranslate"><span class="pre">stimulus_names</span></code> for the session.
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">stimulus_names</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;spontaneous&#39;,
 &#39;gabors&#39;,
 &#39;flashes&#39;,
 &#39;drifting_gratings&#39;,
 &#39;natural_movie_three&#39;,
 &#39;natural_movie_one&#39;,
 &#39;static_gratings&#39;,
 &#39;natural_scenes&#39;]
</pre></div>
</div>
</div>
</div>
<p>:::{admonition} Example: Stimulus epochs
These stimuli are interleaved throughout the session. We can use the
<code class="docutils literal notranslate"><span class="pre">stimulus_epochs</span></code> to see when each stimulus type was presented. Then we’ll add
this to the activity plot we made above.
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stimulus_epochs</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_stimulus_epochs</span><span class="p">()</span>
<span class="n">stimulus_epochs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>start_time</th>
      <th>stop_time</th>
      <th>duration</th>
      <th>stimulus_name</th>
      <th>stimulus_block</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>24.343718</td>
      <td>84.410468</td>
      <td>60.066750</td>
      <td>spontaneous</td>
      <td>null</td>
    </tr>
    <tr>
      <th>1</th>
      <td>84.410468</td>
      <td>996.405519</td>
      <td>911.995051</td>
      <td>gabors</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>996.405519</td>
      <td>1285.396908</td>
      <td>288.991389</td>
      <td>spontaneous</td>
      <td>null</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1285.396908</td>
      <td>1583.896304</td>
      <td>298.499396</td>
      <td>flashes</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1583.896304</td>
      <td>1585.647748</td>
      <td>1.751444</td>
      <td>spontaneous</td>
      <td>null</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1585.647748</td>
      <td>2185.148542</td>
      <td>599.500795</td>
      <td>drifting_gratings</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2185.148542</td>
      <td>2216.174468</td>
      <td>31.025925</td>
      <td>spontaneous</td>
      <td>null</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2216.174468</td>
      <td>2816.676108</td>
      <td>600.501640</td>
      <td>natural_movie_three</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2816.676108</td>
      <td>2846.701238</td>
      <td>30.025130</td>
      <td>spontaneous</td>
      <td>null</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2846.701238</td>
      <td>3146.952038</td>
      <td>300.250800</td>
      <td>natural_movie_one</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>3146.952038</td>
      <td>3176.977098</td>
      <td>30.025060</td>
      <td>spontaneous</td>
      <td>null</td>
    </tr>
    <tr>
      <th>11</th>
      <td>3176.977098</td>
      <td>3776.477932</td>
      <td>599.500835</td>
      <td>drifting_gratings</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>3776.477932</td>
      <td>4077.729588</td>
      <td>301.251655</td>
      <td>spontaneous</td>
      <td>null</td>
    </tr>
    <tr>
      <th>13</th>
      <td>4077.729588</td>
      <td>4678.231228</td>
      <td>600.501640</td>
      <td>natural_movie_three</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>4678.231228</td>
      <td>4708.256308</td>
      <td>30.025080</td>
      <td>spontaneous</td>
      <td>null</td>
    </tr>
    <tr>
      <th>15</th>
      <td>4708.256308</td>
      <td>5397.832372</td>
      <td>689.576065</td>
      <td>drifting_gratings</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>5397.832372</td>
      <td>5398.833208</td>
      <td>1.000835</td>
      <td>spontaneous</td>
      <td>null</td>
    </tr>
    <tr>
      <th>17</th>
      <td>5398.833208</td>
      <td>5879.267878</td>
      <td>480.434670</td>
      <td>static_gratings</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>5879.267878</td>
      <td>5909.292938</td>
      <td>30.025060</td>
      <td>spontaneous</td>
      <td>null</td>
    </tr>
    <tr>
      <th>19</th>
      <td>5909.292938</td>
      <td>6389.694278</td>
      <td>480.401340</td>
      <td>natural_scenes</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>6389.694278</td>
      <td>6689.945098</td>
      <td>300.250820</td>
      <td>spontaneous</td>
      <td>null</td>
    </tr>
    <tr>
      <th>21</th>
      <td>6689.945098</td>
      <td>7170.346408</td>
      <td>480.401310</td>
      <td>natural_scenes</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>22</th>
      <td>7170.346408</td>
      <td>7200.371488</td>
      <td>30.025080</td>
      <td>spontaneous</td>
      <td>null</td>
    </tr>
    <tr>
      <th>23</th>
      <td>7200.371488</td>
      <td>7680.772808</td>
      <td>480.401320</td>
      <td>static_gratings</td>
      <td>11.0</td>
    </tr>
    <tr>
      <th>24</th>
      <td>7680.772808</td>
      <td>7710.797908</td>
      <td>30.025100</td>
      <td>spontaneous</td>
      <td>null</td>
    </tr>
    <tr>
      <th>25</th>
      <td>7710.797908</td>
      <td>8011.048698</td>
      <td>300.250790</td>
      <td>natural_movie_one</td>
      <td>12.0</td>
    </tr>
    <tr>
      <th>26</th>
      <td>8011.048698</td>
      <td>8041.073788</td>
      <td>30.025090</td>
      <td>spontaneous</td>
      <td>null</td>
    </tr>
    <tr>
      <th>27</th>
      <td>8041.073788</td>
      <td>8569.014840</td>
      <td>527.941052</td>
      <td>natural_scenes</td>
      <td>13.0</td>
    </tr>
    <tr>
      <th>28</th>
      <td>8569.014840</td>
      <td>8611.550348</td>
      <td>42.535508</td>
      <td>spontaneous</td>
      <td>null</td>
    </tr>
    <tr>
      <th>29</th>
      <td>8611.550348</td>
      <td>9152.001828</td>
      <td>540.451480</td>
      <td>static_gratings</td>
      <td>14.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Remake our plot of V1 activity from above, adding this stimulus epoch
information. Shade each stimulus with a unique color. The <strong>plt.axvspan()</strong> is a
useful function for this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numunits</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">v1_binned</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">/</span><span class="mf">30.</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span><span class="s1">&#39;green&#39;</span><span class="p">,</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="s1">&#39;lightblue&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">stim_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">stimulus_names</span><span class="p">):</span>
    <span class="n">stim</span> <span class="o">=</span> <span class="n">stimulus_epochs</span><span class="p">[</span><span class="n">stimulus_epochs</span><span class="o">.</span><span class="n">stimulus_name</span><span class="o">==</span><span class="n">stim_name</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stim</span><span class="p">)):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">stim</span><span class="p">[</span><span class="s2">&quot;start_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">xmax</span><span class="o">=</span><span class="n">stim</span><span class="p">[</span><span class="s2">&quot;stop_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/vcnp_98_0.png" src="../_images/vcnp_98_0.png" />
</div>
</div>
<p>Before we dig into the stimulus information in more detail, let’s find one more piece of session-wide data that’s in the dataset. Running speed.</p>
<p>:::{admonition} Example: Get the running speed
Before we dig further into the stimulus information in more detail, let’s add
one more piece of session-wide data to our plot. The mouse’s running speed.</p>
<p>Get the <code class="docutils literal notranslate"><span class="pre">running_speed</span></code> and its time stamps from the session object. Plot the
speed as a function of time.
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">running_speed</span><span class="o">.</span><span class="n">end_time</span><span class="p">,</span> <span class="n">session</span><span class="o">.</span><span class="n">running_speed</span><span class="o">.</span><span class="n">velocity</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Running speed (cm/s)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Running speed (cm/s)&#39;)
</pre></div>
</div>
<img alt="../_images/vcnp_100_1.png" src="../_images/vcnp_100_1.png" />
</div>
</div>
<p>Add the running speed to the plot of V1 activity and stimulus epochs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numunits</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">v1_binned</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">/</span><span class="mf">30.</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>

<span class="c1">#scale the running speed and offset it on the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">running_speed</span><span class="o">.</span><span class="n">end_time</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.3</span><span class="o">*</span><span class="n">session</span><span class="o">.</span><span class="n">running_speed</span><span class="o">.</span><span class="n">velocity</span><span class="p">)</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span><span class="s1">&#39;green&#39;</span><span class="p">,</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="s1">&#39;lightblue&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">stim_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">stimulus_names</span><span class="p">):</span>
    <span class="n">stim</span> <span class="o">=</span> <span class="n">stimulus_epochs</span><span class="p">[</span><span class="n">stimulus_epochs</span><span class="o">.</span><span class="n">stimulus_name</span><span class="o">==</span><span class="n">stim_name</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stim</span><span class="p">)):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">stim</span><span class="p">[</span><span class="s2">&quot;start_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">xmax</span><span class="o">=</span><span class="n">stim</span><span class="p">[</span><span class="s2">&quot;stop_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">52</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(-10.0, 52.0)
</pre></div>
</div>
<img alt="../_images/vcnp_102_1.png" src="../_images/vcnp_102_1.png" />
</div>
</div>
<p>:::{admonition} Example: Stimulus presentations
Now let’s go back and learn more about the stimulus that was presented. The
session object has a function that returns a table for a given stimulus called
<code class="docutils literal notranslate"><span class="pre">get_stimulus_table</span></code>.</p>
<p>Use this to get the stimulus table for drifting gratings and for natural scenes.
What information do these tables provide? How are they different?
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stim_table</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_stimulus_table</span><span class="p">([</span><span class="s1">&#39;drifting_gratings&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stim_table</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>contrast</th>
      <th>orientation</th>
      <th>phase</th>
      <th>size</th>
      <th>spatial_frequency</th>
      <th>start_time</th>
      <th>stimulus_block</th>
      <th>stimulus_name</th>
      <th>stop_time</th>
      <th>temporal_frequency</th>
      <th>duration</th>
      <th>stimulus_condition_id</th>
    </tr>
    <tr>
      <th>stimulus_presentation_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3798</th>
      <td>0.8</td>
      <td>180.0</td>
      <td>[21235.93333333, 21235.93333333]</td>
      <td>[250.0, 250.0]</td>
      <td>0.04</td>
      <td>1585.647748</td>
      <td>2.0</td>
      <td>drifting_gratings</td>
      <td>1587.649398</td>
      <td>4.0</td>
      <td>2.00165</td>
      <td>246</td>
    </tr>
    <tr>
      <th>3799</th>
      <td>0.8</td>
      <td>225.0</td>
      <td>[21235.93333333, 21235.93333333]</td>
      <td>[250.0, 250.0]</td>
      <td>0.04</td>
      <td>1588.650242</td>
      <td>2.0</td>
      <td>drifting_gratings</td>
      <td>1590.651902</td>
      <td>4.0</td>
      <td>2.00166</td>
      <td>247</td>
    </tr>
    <tr>
      <th>3800</th>
      <td>0.8</td>
      <td>135.0</td>
      <td>[21235.93333333, 21235.93333333]</td>
      <td>[250.0, 250.0]</td>
      <td>0.04</td>
      <td>1591.652728</td>
      <td>2.0</td>
      <td>drifting_gratings</td>
      <td>1593.654418</td>
      <td>2.0</td>
      <td>2.00169</td>
      <td>248</td>
    </tr>
    <tr>
      <th>3801</th>
      <td>0.8</td>
      <td>0.0</td>
      <td>[21235.93333333, 21235.93333333]</td>
      <td>[250.0, 250.0]</td>
      <td>0.04</td>
      <td>1594.655252</td>
      <td>2.0</td>
      <td>drifting_gratings</td>
      <td>1596.656912</td>
      <td>2.0</td>
      <td>2.00166</td>
      <td>249</td>
    </tr>
    <tr>
      <th>3802</th>
      <td>0.8</td>
      <td>315.0</td>
      <td>[21235.93333333, 21235.93333333]</td>
      <td>[250.0, 250.0]</td>
      <td>0.04</td>
      <td>1597.657758</td>
      <td>2.0</td>
      <td>drifting_gratings</td>
      <td>1599.659418</td>
      <td>15.0</td>
      <td>2.00166</td>
      <td>250</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now get the stimulus table for natural scenes. What is different about these tables?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stim_table_ns</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_stimulus_table</span><span class="p">([</span><span class="s1">&#39;natural_scenes&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stim_table_ns</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>frame</th>
      <th>start_time</th>
      <th>stimulus_block</th>
      <th>stimulus_name</th>
      <th>stop_time</th>
      <th>duration</th>
      <th>stimulus_condition_id</th>
    </tr>
    <tr>
      <th>stimulus_presentation_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>51355</th>
      <td>72.0</td>
      <td>5909.292938</td>
      <td>9.0</td>
      <td>natural_scenes</td>
      <td>5909.543151</td>
      <td>0.250214</td>
      <td>4908</td>
    </tr>
    <tr>
      <th>51356</th>
      <td>96.0</td>
      <td>5909.543151</td>
      <td>9.0</td>
      <td>natural_scenes</td>
      <td>5909.793365</td>
      <td>0.250214</td>
      <td>4909</td>
    </tr>
    <tr>
      <th>51357</th>
      <td>109.0</td>
      <td>5909.793365</td>
      <td>9.0</td>
      <td>natural_scenes</td>
      <td>5910.043579</td>
      <td>0.250214</td>
      <td>4910</td>
    </tr>
    <tr>
      <th>51358</th>
      <td>105.0</td>
      <td>5910.043579</td>
      <td>9.0</td>
      <td>natural_scenes</td>
      <td>5910.293792</td>
      <td>0.250214</td>
      <td>4911</td>
    </tr>
    <tr>
      <th>51359</th>
      <td>89.0</td>
      <td>5910.293792</td>
      <td>9.0</td>
      <td>natural_scenes</td>
      <td>5910.543999</td>
      <td>0.250206</td>
      <td>4912</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>:::{admonition} Example: Drifting gratings stimulus parameters
Use the drifting grating stimulus table to determine what are the unique
parameters for the different stimulus conditions of this stimulus.
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stim_table</span><span class="o">.</span><span class="n">orientation</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([180.0, 225.0, 135.0, 0.0, 315.0, 90.0, 270.0, &#39;null&#39;, 45.0],
      dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stim_table</span><span class="o">.</span><span class="n">spatial_frequency</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;0.04&#39;, &#39;null&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stim_table</span><span class="o">.</span><span class="n">temporal_frequency</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([4.0, 2.0, 15.0, 8.0, 1.0, &#39;null&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stim_table</span><span class="o">.</span><span class="n">contrast</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.8, &#39;null&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>What do you think the ‘null’ conditions are?</p>
<p>:::{admonition} Example: Natural scenes stimulus
Use the stimulus table for natural scenes to find all the times when a
particular image is presented during the session, and add it to the plot of
activity in V1. Pick the first image that was presented in this session.
:::</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stim_table_ns</span><span class="p">[</span><span class="n">stim_table_ns</span><span class="o">.</span><span class="n">frame</span><span class="o">==</span><span class="n">stim_table_ns</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>frame</th>
      <th>start_time</th>
      <th>stimulus_block</th>
      <th>stimulus_name</th>
      <th>stop_time</th>
      <th>duration</th>
      <th>stimulus_condition_id</th>
    </tr>
    <tr>
      <th>stimulus_presentation_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>51355</th>
      <td>72.0</td>
      <td>5909.292938</td>
      <td>9.0</td>
      <td>natural_scenes</td>
      <td>5909.543151</td>
      <td>0.250214</td>
      <td>4908</td>
    </tr>
    <tr>
      <th>51445</th>
      <td>72.0</td>
      <td>5931.811770</td>
      <td>9.0</td>
      <td>natural_scenes</td>
      <td>5932.061981</td>
      <td>0.250211</td>
      <td>4908</td>
    </tr>
    <tr>
      <th>51493</th>
      <td>72.0</td>
      <td>5943.821815</td>
      <td>9.0</td>
      <td>natural_scenes</td>
      <td>5944.072019</td>
      <td>0.250204</td>
      <td>4908</td>
    </tr>
    <tr>
      <th>51575</th>
      <td>72.0</td>
      <td>5964.338952</td>
      <td>9.0</td>
      <td>natural_scenes</td>
      <td>5964.589161</td>
      <td>0.250209</td>
      <td>4908</td>
    </tr>
    <tr>
      <th>51696</th>
      <td>72.0</td>
      <td>5994.614226</td>
      <td>9.0</td>
      <td>natural_scenes</td>
      <td>5994.864430</td>
      <td>0.250204</td>
      <td>4908</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>How many times was it presented?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">stim_table_ns</span><span class="p">[</span><span class="n">stim_table_ns</span><span class="o">.</span><span class="n">frame</span><span class="o">==</span><span class="n">stim_table_ns</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>50
</pre></div>
</div>
</div>
</div>
<p>Mark the times when this particular scene was presented on our plot of the activity (without the epochs and running speed).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numunits</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">v1_binned</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">/</span><span class="mf">30.</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>

<span class="n">stim_subset</span> <span class="o">=</span> <span class="n">stim_table_ns</span><span class="p">[</span><span class="n">stim_table_ns</span><span class="o">.</span><span class="n">frame</span><span class="o">==</span><span class="n">stim_table_ns</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stim_subset</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">stim_subset</span><span class="o">.</span><span class="n">start_time</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">xmax</span><span class="o">=</span><span class="n">stim_subset</span><span class="o">.</span><span class="n">stop_time</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">5000</span><span class="p">,</span><span class="mi">9000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(5000.0, 9000.0)
</pre></div>
</div>
<img alt="../_images/vcnp_119_1.png" src="../_images/vcnp_119_1.png" />
</div>
</div>
<p>:::{admonition} Example: Stimulus template
What is this image? The <code class="docutils literal notranslate"><span class="pre">stimulus</span> <span class="pre">template</span></code> provides the images and movies that were presented to the mouse. These are only provided for stimuli that are images (natural scenes, natural movies) - parametric stimuli (eg. gratings) do not have templates.
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">image_num</span> <span class="o">=</span> <span class="mi">96</span>
<span class="n">image_template</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get_natural_scene_template</span><span class="p">(</span><span class="n">image_num</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_template</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7fea332858e0&gt;
</pre></div>
</div>
<img alt="../_images/vcnp_121_1.png" src="../_images/vcnp_121_1.png" />
</div>
</div>
<p>:::{admonition} Example: Single trial raster plots for all units
Now that we’ve seen the pieces of data, we can explore the neural activity in
greater detail. Make a raster plot for a single presentation of the drifting
grating stimulus at orientation = 45 degrees and temporal frequency = 2 Hz.</p>
<p>To start, make a function to make a raster plot of all the units in the experiment.
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_raster</span><span class="p">(</span><span class="n">spike_times</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
    <span class="n">num_units</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spike_times</span><span class="p">)</span>
    <span class="n">ystep</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">num_units</span>

    <span class="n">ymin</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ymax</span> <span class="o">=</span> <span class="n">ystep</span>

    <span class="k">for</span> <span class="n">unit_id</span><span class="p">,</span> <span class="n">unit_spike_times</span> <span class="ow">in</span> <span class="n">spike_times</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">unit_spike_times</span> <span class="o">=</span> <span class="n">unit_spike_times</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">unit_spike_times</span> <span class="o">&gt;=</span> <span class="n">start</span><span class="p">,</span> <span class="n">unit_spike_times</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">)]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">unit_spike_times</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">)</span>

        <span class="n">ymin</span> <span class="o">+=</span> <span class="n">ystep</span>
        <span class="n">ymax</span> <span class="o">+=</span> <span class="n">ystep</span>
</pre></div>
</div>
</div>
</div>
<p>Find the first presentation of our chosen grating condition.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stim_table</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_stimulus_table</span><span class="p">([</span><span class="s1">&#39;drifting_gratings&#39;</span><span class="p">])</span>
<span class="n">subset</span> <span class="o">=</span> <span class="n">stim_table</span><span class="p">[(</span><span class="n">stim_table</span><span class="o">.</span><span class="n">orientation</span><span class="o">==</span><span class="mi">45</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">stim_table</span><span class="o">.</span><span class="n">temporal_frequency</span><span class="o">==</span><span class="mi">2</span><span class="p">)]</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">stim_table</span><span class="o">.</span><span class="n">start_time</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">stim_table</span><span class="o">.</span><span class="n">stop_time</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Use the plot_raster function to plot the response of all units to this trial. Pad the raster plot with half a second before and after the trial, and shade the trial red (with an alpha of 0.1)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plot_raster</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">spike_times</span><span class="p">,</span> <span class="n">start</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">end</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (sec)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/vcnp_127_0.png" src="../_images/vcnp_127_0.png" />
</div>
</div>
<p>:::{admonition} Example: Single trial raster plots for all units
Use the <code class="docutils literal notranslate"><span class="pre">unit</span></code> dataframe to arrange the neurons in the raster plot according to
their overall firing rate.
:::</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;firing_rate&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>waveform_PT_ratio</th>
      <th>waveform_amplitude</th>
      <th>amplitude_cutoff</th>
      <th>cluster_id</th>
      <th>cumulative_drift</th>
      <th>d_prime</th>
      <th>firing_rate</th>
      <th>isi_violations</th>
      <th>isolation_distance</th>
      <th>L_ratio</th>
      <th>...</th>
      <th>ecephys_structure_id</th>
      <th>ecephys_structure_acronym</th>
      <th>anterior_posterior_ccf_coordinate</th>
      <th>dorsal_ventral_ccf_coordinate</th>
      <th>left_right_ccf_coordinate</th>
      <th>probe_description</th>
      <th>location</th>
      <th>probe_sampling_rate</th>
      <th>probe_lfp_sampling_rate</th>
      <th>probe_has_lfp_data</th>
    </tr>
    <tr>
      <th>unit_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>951817746</th>
      <td>0.397098</td>
      <td>201.534645</td>
      <td>0.079703</td>
      <td>70</td>
      <td>169.60</td>
      <td>4.684260</td>
      <td>66.261032</td>
      <td>0.004826</td>
      <td>85.556209</td>
      <td>0.008705</td>
      <td>...</td>
      <td>8.0</td>
      <td>grey</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>probeA</td>
      <td>See electrode locations</td>
      <td>29999.968724</td>
      <td>1249.998697</td>
      <td>True</td>
    </tr>
    <tr>
      <th>951817763</th>
      <td>0.512873</td>
      <td>126.414405</td>
      <td>0.025284</td>
      <td>72</td>
      <td>240.35</td>
      <td>5.139323</td>
      <td>59.038540</td>
      <td>0.004292</td>
      <td>116.121088</td>
      <td>0.000195</td>
      <td>...</td>
      <td>8.0</td>
      <td>grey</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>probeA</td>
      <td>See electrode locations</td>
      <td>29999.968724</td>
      <td>1249.998697</td>
      <td>True</td>
    </tr>
    <tr>
      <th>951826934</th>
      <td>0.860666</td>
      <td>136.272435</td>
      <td>0.030561</td>
      <td>391</td>
      <td>110.97</td>
      <td>3.144957</td>
      <td>51.388427</td>
      <td>0.004762</td>
      <td>93.466196</td>
      <td>0.003403</td>
      <td>...</td>
      <td>402.0</td>
      <td>VISal</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>probeE</td>
      <td>See electrode locations</td>
      <td>29999.998841</td>
      <td>1249.999952</td>
      <td>True</td>
    </tr>
    <tr>
      <th>951817924</th>
      <td>0.493302</td>
      <td>400.143510</td>
      <td>0.000030</td>
      <td>93</td>
      <td>203.36</td>
      <td>5.187385</td>
      <td>48.593865</td>
      <td>0.000081</td>
      <td>90.534132</td>
      <td>0.015623</td>
      <td>...</td>
      <td>8.0</td>
      <td>grey</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>probeA</td>
      <td>See electrode locations</td>
      <td>29999.968724</td>
      <td>1249.998697</td>
      <td>True</td>
    </tr>
    <tr>
      <th>951808847</th>
      <td>0.191955</td>
      <td>216.576945</td>
      <td>0.005776</td>
      <td>54</td>
      <td>127.30</td>
      <td>4.795370</td>
      <td>48.450483</td>
      <td>0.012074</td>
      <td>125.713434</td>
      <td>0.009495</td>
      <td>...</td>
      <td>170.0</td>
      <td>LGd</td>
      <td>8029.0</td>
      <td>3711.0</td>
      <td>8248.0</td>
      <td>probeD</td>
      <td>See electrode locations</td>
      <td>29999.922462</td>
      <td>1249.996769</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 40 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;firing_rate&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">firing_rate</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Firing rate (Hz)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Unit #&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 0, &#39;Unit #&#39;)
</pre></div>
</div>
<img alt="../_images/vcnp_130_1.png" src="../_images/vcnp_130_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">by_fr</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;firing_rate&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">spike_times_by_firing_rate</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">uid</span><span class="p">:</span> <span class="n">session</span><span class="o">.</span><span class="n">spike_times</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span> <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">by_fr</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
<span class="p">}</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plot_raster</span><span class="p">(</span><span class="n">spike_times_by_firing_rate</span><span class="p">,</span> <span class="n">start</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">end</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (sec)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/vcnp_131_0.png" src="../_images/vcnp_131_0.png" />
</div>
</div>
</section>
<section id="stimulus-responses">
<h2>Stimulus responses<a class="headerlink" href="#stimulus-responses" title="Permalink to this headline">#</a></h2>
<p>A lot of the analysis of these data will requires comparing responses of
neurons to different stimulus conditions and presentations. The SDK has
functions to help access these, sorting the spike data into responses for each
stimulus presentations and converting from spike times to binned spike counts.
This spike histogram representation is more useful for many computations, since
it can be treated as a timeseries and directly averaged across presentations.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">presentationwise_spike_counts</span></code> provides the histograms for specified
stimulus presentation trials for specified units. The function requires
<strong>stimulus_presentation_ids</strong> for the stimulus in question, <strong>unit_ids</strong> for the
relevant units, and <strong>bin_edges</strong> to specify the time bins to count spikes in
(relative to stimulus onset).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">conditionwise_spike_statistics</span></code> creates a summary of specified units
responses to specified stimulus conditions, including the mean spike count,
standard deviation, and standard error of the mean.</p>
<p>:::{admonition} Example: Presentation-wise analysis for drifting gratings
Pick  a specific condition of the drifting grating stimulus and create spike histograms for the units in V1.
Create bins at a 10 ms resolution so we can see dynamics on a fast timescale.
:::</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stim_table</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>contrast</th>
      <th>orientation</th>
      <th>phase</th>
      <th>size</th>
      <th>spatial_frequency</th>
      <th>start_time</th>
      <th>stimulus_block</th>
      <th>stimulus_name</th>
      <th>stop_time</th>
      <th>temporal_frequency</th>
      <th>duration</th>
      <th>stimulus_condition_id</th>
    </tr>
    <tr>
      <th>stimulus_presentation_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3798</th>
      <td>0.8</td>
      <td>180.0</td>
      <td>[21235.93333333, 21235.93333333]</td>
      <td>[250.0, 250.0]</td>
      <td>0.04</td>
      <td>1585.647748</td>
      <td>2.0</td>
      <td>drifting_gratings</td>
      <td>1587.649398</td>
      <td>4.0</td>
      <td>2.00165</td>
      <td>246</td>
    </tr>
    <tr>
      <th>3799</th>
      <td>0.8</td>
      <td>225.0</td>
      <td>[21235.93333333, 21235.93333333]</td>
      <td>[250.0, 250.0]</td>
      <td>0.04</td>
      <td>1588.650242</td>
      <td>2.0</td>
      <td>drifting_gratings</td>
      <td>1590.651902</td>
      <td>4.0</td>
      <td>2.00166</td>
      <td>247</td>
    </tr>
    <tr>
      <th>3800</th>
      <td>0.8</td>
      <td>135.0</td>
      <td>[21235.93333333, 21235.93333333]</td>
      <td>[250.0, 250.0]</td>
      <td>0.04</td>
      <td>1591.652728</td>
      <td>2.0</td>
      <td>drifting_gratings</td>
      <td>1593.654418</td>
      <td>2.0</td>
      <td>2.00169</td>
      <td>248</td>
    </tr>
    <tr>
      <th>3801</th>
      <td>0.8</td>
      <td>0.0</td>
      <td>[21235.93333333, 21235.93333333]</td>
      <td>[250.0, 250.0]</td>
      <td>0.04</td>
      <td>1594.655252</td>
      <td>2.0</td>
      <td>drifting_gratings</td>
      <td>1596.656912</td>
      <td>2.0</td>
      <td>2.00166</td>
      <td>249</td>
    </tr>
    <tr>
      <th>3802</th>
      <td>0.8</td>
      <td>315.0</td>
      <td>[21235.93333333, 21235.93333333]</td>
      <td>[250.0, 250.0]</td>
      <td>0.04</td>
      <td>1597.657758</td>
      <td>2.0</td>
      <td>drifting_gratings</td>
      <td>1599.659418</td>
      <td>15.0</td>
      <td>2.00166</td>
      <td>250</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># specify the time bins in seconds, relative to stimulus onset</span>
<span class="n">time_step</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">100.</span>
<span class="n">duration</span> <span class="o">=</span> <span class="n">stim_table</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">time_domain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="o">+</span><span class="n">time_step</span><span class="p">,</span> <span class="n">time_step</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">time_domain</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(202,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stim_ids</span> <span class="o">=</span> <span class="n">stim_table</span><span class="p">[(</span><span class="n">stim_table</span><span class="o">.</span><span class="n">orientation</span><span class="o">==</span><span class="mi">90</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">stim_table</span><span class="o">.</span><span class="n">temporal_frequency</span><span class="o">==</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stim_ids</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(15,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">histograms</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">presentationwise_spike_counts</span><span class="p">(</span><span class="n">bin_edges</span><span class="o">=</span><span class="n">time_domain</span><span class="p">,</span>
                                                   <span class="n">stimulus_presentation_ids</span><span class="o">=</span><span class="n">stim_ids</span><span class="p">,</span>
                                                   <span class="n">unit_ids</span><span class="o">=</span><span class="n">v1_units</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>What type of object is this? What is its shape?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">histograms</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>xarray.core.dataarray.DataArray
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">histograms</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(15, 201, 63)
</pre></div>
</div>
</div>
</div>
<section id="xarray">
<h3>Xarray<a class="headerlink" href="#xarray" title="Permalink to this headline">#</a></h3>
<p>This has returned a new (to this notebook) data structure, the
<code class="docutils literal notranslate"><span class="pre">xarray.DataArray</span></code>. You can think of this as similar to a 3+D
<code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code>, or as a <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> with labeled axes and indices. See
the <a class="reference external" href="http://xarray.pydata.org/en/stable/index.html">xarray documentation</a> for
more information. In the mean time, the salient features are:</p>
<ul class="simple">
<li><p>Dimensions : Each axis on each data variable is associated with a named
dimension. This lets us see unambiguously what the axes of our array mean.</p></li>
<li><p>Coordinates : Arrays of labels for each sample on each dimension.</p></li>
</ul>
<p>xarray is nice because it forces code to be explicit about dimensions and
coordinates, improving readability and avoiding bugs. However, you can always
convert to numpy or pandas data structures as follows:</p>
<ul class="simple">
<li><p>to pandas: <code class="docutils literal notranslate"><span class="pre">histograms.to_dataframe()</span></code> produces a multiindexed dataframe</p></li>
<li><p>to numpy: <code class="docutils literal notranslate"><span class="pre">histograms.values</span></code> gives you access to the underlying numpy array</p></li>
</ul>
<p>:::{admonition} Example: Plot the unit’s response
Plot the response of the first unit to all 15 trials.
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">histograms</span><span class="o">.</span><span class="n">time_relative_to_stimulus_onset</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="n">histograms</span><span class="p">[</span><span class="n">i</span><span class="p">,:,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Trials&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Trials&#39;)
</pre></div>
</div>
<img alt="../_images/vcnp_141_1.png" src="../_images/vcnp_141_1.png" />
</div>
</div>
<p>:::{admonition} Example: Compute the average response over trials for all units
Plot a heatmap of mean response for all units in V1.
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_histograms</span> <span class="o">=</span> <span class="n">histograms</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;stimulus_presentation_id&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_histograms</span><span class="o">.</span><span class="n">coords</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Coordinates:
  * time_relative_to_stimulus_onset  (time_relative_to_stimulus_onset) float64 ...
  * unit_id                          (unit_id) int64 951814973 ... 951816492
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray.plot</span> <span class="k">as</span> <span class="nn">xrplot</span>
<span class="n">xrplot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">darray</span><span class="o">=</span><span class="n">mean_histograms</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;time_relative_to_stimulus_onset&quot;</span><span class="p">,</span>
                                      <span class="n">y</span><span class="o">=</span><span class="s2">&quot;unit_id&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7fe9a003ca60&gt;
</pre></div>
</div>
<img alt="../_images/vcnp_145_1.png" src="../_images/vcnp_145_1.png" />
</div>
</div>
<p>:::{admonition} Example: Conditionwise analysis
In order to compute a tuning curve that summarizes the responses of a unit to
each stimulus condition of a stimulus, use the <code class="docutils literal notranslate"><span class="pre">conditionwise_spike_statistics</span></code>
to summarize the activity of specific units to the different stimulus
conditions.
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stim_ids</span> <span class="o">=</span> <span class="n">stim_table</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dg_stats</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">conditionwise_spike_statistics</span><span class="p">(</span><span class="n">stimulus_presentation_ids</span><span class="o">=</span><span class="n">stim_ids</span><span class="p">,</span> <span class="n">unit_ids</span><span class="o">=</span><span class="n">v1_units</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>What type of object is this? What is its shape?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">dg_stats</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas.core.frame.DataFrame
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dg_stats</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2583, 5)
</pre></div>
</div>
</div>
</div>
<p>What are its columns?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dg_stats</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;spike_count&#39;, &#39;stimulus_presentation_count&#39;, &#39;spike_mean&#39;, &#39;spike_std&#39;,
       &#39;spike_sem&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p>Can you explain the first dimension?</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dg_stats</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>spike_count</th>
      <th>stimulus_presentation_count</th>
      <th>spike_mean</th>
      <th>spike_std</th>
      <th>spike_sem</th>
    </tr>
    <tr>
      <th>unit_id</th>
      <th>stimulus_condition_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>951814973</th>
      <th>246</th>
      <td>54</td>
      <td>15</td>
      <td>3.600000</td>
      <td>7.048809</td>
      <td>1.819995</td>
    </tr>
    <tr>
      <th>951814989</th>
      <th>246</th>
      <td>32</td>
      <td>15</td>
      <td>2.133333</td>
      <td>2.614975</td>
      <td>0.675184</td>
    </tr>
    <tr>
      <th>951815078</th>
      <th>246</th>
      <td>150</td>
      <td>15</td>
      <td>10.000000</td>
      <td>8.912271</td>
      <td>2.301138</td>
    </tr>
    <tr>
      <th>951815103</th>
      <th>246</th>
      <td>18</td>
      <td>15</td>
      <td>1.200000</td>
      <td>1.971222</td>
      <td>0.508967</td>
    </tr>
    <tr>
      <th>951815110</th>
      <th>246</th>
      <td>17</td>
      <td>15</td>
      <td>1.133333</td>
      <td>2.065591</td>
      <td>0.533333</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>:::{admonition} Example: Merge the conditionwise statistics with stimulus information
In order to link the stimulus responses with the stimulus conditions, merge the
spike_statistics output with the stimulus table using <code class="docutils literal notranslate"><span class="pre">pd.merge()</span></code>.
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dg_stats_stim</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">dg_stats</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;stimulus_condition_id&#39;</span><span class="p">]),</span>
    <span class="n">session</span><span class="o">.</span><span class="n">stimulus_conditions</span><span class="p">,</span>
    <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;stimulus_condition_id&#39;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;unit_id&#39;</span><span class="p">,</span> <span class="s1">&#39;stimulus_condition_id&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>This dataframe currently has a <em>multi-index</em>, meaning that each row is indexed
by the pair of unit_id and stimulus_condition_id, rather than a single
identifier. There are several ways to use this index:</p>
<ul class="simple">
<li><p>specify the pair of identifiers as a tuple: <code class="docutils literal notranslate"><span class="pre">dg_stats_stim.loc[(unit_id,</span> <span class="pre">stim_id)]</span></code></p></li>
<li><p>specifying the axis makes it easier to get all rows for one unit: <code class="docutils literal notranslate"><span class="pre">dg_stats_stim.loc(axis=0)[unit_id,</span> <span class="pre">:]</span></code></p></li>
<li><p>or you can use <code class="docutils literal notranslate"><span class="pre">dg_stats_stim.reset_index()</span></code> to move the index to regular columns</p></li>
</ul>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dg_stats_stim</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>spike_count</th>
      <th>stimulus_presentation_count</th>
      <th>spike_mean</th>
      <th>spike_std</th>
      <th>spike_sem</th>
      <th>color</th>
      <th>contrast</th>
      <th>frame</th>
      <th>mask</th>
      <th>opacity</th>
      <th>orientation</th>
      <th>phase</th>
      <th>size</th>
      <th>spatial_frequency</th>
      <th>stimulus_name</th>
      <th>temporal_frequency</th>
      <th>units</th>
      <th>x_position</th>
      <th>y_position</th>
      <th>color_triplet</th>
    </tr>
    <tr>
      <th>unit_id</th>
      <th>stimulus_condition_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>951814973</th>
      <th>246</th>
      <td>54</td>
      <td>15</td>
      <td>3.600000</td>
      <td>7.048809</td>
      <td>1.819995</td>
      <td>null</td>
      <td>0.8</td>
      <td>null</td>
      <td>None</td>
      <td>True</td>
      <td>180.0</td>
      <td>[21235.93333333, 21235.93333333]</td>
      <td>[250.0, 250.0]</td>
      <td>0.04</td>
      <td>drifting_gratings</td>
      <td>4.0</td>
      <td>deg</td>
      <td>null</td>
      <td>null</td>
      <td>[1.0, 1.0, 1.0]</td>
    </tr>
    <tr>
      <th>951814989</th>
      <th>246</th>
      <td>32</td>
      <td>15</td>
      <td>2.133333</td>
      <td>2.614975</td>
      <td>0.675184</td>
      <td>null</td>
      <td>0.8</td>
      <td>null</td>
      <td>None</td>
      <td>True</td>
      <td>180.0</td>
      <td>[21235.93333333, 21235.93333333]</td>
      <td>[250.0, 250.0]</td>
      <td>0.04</td>
      <td>drifting_gratings</td>
      <td>4.0</td>
      <td>deg</td>
      <td>null</td>
      <td>null</td>
      <td>[1.0, 1.0, 1.0]</td>
    </tr>
    <tr>
      <th>951815078</th>
      <th>246</th>
      <td>150</td>
      <td>15</td>
      <td>10.000000</td>
      <td>8.912271</td>
      <td>2.301138</td>
      <td>null</td>
      <td>0.8</td>
      <td>null</td>
      <td>None</td>
      <td>True</td>
      <td>180.0</td>
      <td>[21235.93333333, 21235.93333333]</td>
      <td>[250.0, 250.0]</td>
      <td>0.04</td>
      <td>drifting_gratings</td>
      <td>4.0</td>
      <td>deg</td>
      <td>null</td>
      <td>null</td>
      <td>[1.0, 1.0, 1.0]</td>
    </tr>
    <tr>
      <th>951815103</th>
      <th>246</th>
      <td>18</td>
      <td>15</td>
      <td>1.200000</td>
      <td>1.971222</td>
      <td>0.508967</td>
      <td>null</td>
      <td>0.8</td>
      <td>null</td>
      <td>None</td>
      <td>True</td>
      <td>180.0</td>
      <td>[21235.93333333, 21235.93333333]</td>
      <td>[250.0, 250.0]</td>
      <td>0.04</td>
      <td>drifting_gratings</td>
      <td>4.0</td>
      <td>deg</td>
      <td>null</td>
      <td>null</td>
      <td>[1.0, 1.0, 1.0]</td>
    </tr>
    <tr>
      <th>951815110</th>
      <th>246</th>
      <td>17</td>
      <td>15</td>
      <td>1.133333</td>
      <td>2.065591</td>
      <td>0.533333</td>
      <td>null</td>
      <td>0.8</td>
      <td>null</td>
      <td>None</td>
      <td>True</td>
      <td>180.0</td>
      <td>[21235.93333333, 21235.93333333]</td>
      <td>[250.0, 250.0]</td>
      <td>0.04</td>
      <td>drifting_gratings</td>
      <td>4.0</td>
      <td>deg</td>
      <td>null</td>
      <td>null</td>
      <td>[1.0, 1.0, 1.0]</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>:::{admonition} Example: Tuning curve
Plot a 2D tuning curve for the first unit, comparing responses across temporal
frequency and orientation.
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unit_id</span> <span class="o">=</span> <span class="n">v1_units</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stim_ids</span> <span class="o">=</span> <span class="n">stim_table</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
<span class="n">session</span><span class="o">.</span><span class="n">get_stimulus_parameter_values</span><span class="p">(</span><span class="n">stimulus_presentation_ids</span><span class="o">=</span><span class="n">stim_ids</span><span class="p">,</span> <span class="n">drop_nulls</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;contrast&#39;: array([0.8], dtype=object),
 &#39;orientation&#39;: array([180.0, 225.0, 135.0, 0.0, 315.0, 90.0, 270.0, 45.0], dtype=object),
 &#39;phase&#39;: array([&#39;[21235.93333333, 21235.93333333]&#39;], dtype=object),
 &#39;size&#39;: array([&#39;[250.0, 250.0]&#39;], dtype=object),
 &#39;spatial_frequency&#39;: array([&#39;0.04&#39;], dtype=object),
 &#39;temporal_frequency&#39;: array([4.0, 2.0, 15.0, 8.0, 1.0], dtype=object)}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">orivals</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_stimulus_parameter_values</span><span class="p">(</span><span class="n">stimulus_presentation_ids</span><span class="o">=</span><span class="n">stim_ids</span><span class="p">,</span> <span class="n">drop_nulls</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;orientation&#39;</span><span class="p">]</span>
<span class="n">tfvals</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_stimulus_parameter_values</span><span class="p">(</span><span class="n">stimulus_presentation_ids</span><span class="o">=</span><span class="n">stim_ids</span><span class="p">,</span> <span class="n">drop_nulls</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;temporal_frequency&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">response_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">orivals</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">tfvals</span><span class="p">)))</span>
<span class="n">response_sem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">orivals</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">tfvals</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ori</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">orivals</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">tf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tfvals</span><span class="p">):</span>
        <span class="n">stim_id</span> <span class="o">=</span> <span class="n">stim_table</span><span class="p">[(</span><span class="n">stim_table</span><span class="o">.</span><span class="n">orientation</span><span class="o">==</span><span class="n">ori</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">stim_table</span><span class="o">.</span><span class="n">temporal_frequency</span><span class="o">==</span><span class="n">tf</span><span class="p">)]</span><span class="o">.</span><span class="n">stimulus_condition_id</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">response_mean</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">dg_stats_stim</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">unit_id</span><span class="p">,</span> <span class="n">stim_id</span><span class="p">)]</span><span class="o">.</span><span class="n">spike_mean</span>
        <span class="n">response_sem</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">dg_stats_stim</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">unit_id</span><span class="p">,</span> <span class="n">stim_id</span><span class="p">)]</span><span class="o">.</span><span class="n">spike_sem</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">response_mean</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Temporal frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Direction (deg)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">tfvals</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">orivals</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/vcnp_165_0.png" src="../_images/vcnp_165_0.png" />
</div>
</div>
</section>
</section>
<section id="local-field-potential-lfp">
<h2>Local Field Potential (LFP)<a class="headerlink" href="#local-field-potential-lfp" title="Permalink to this headline">#</a></h2>
<p>The final aspect of a Neuropixels probe recording we will investigate is the local field potential (LFP). An LFP signal is a direct recordings of extracellular voltage from which individual spike contributions have been removed by low-pass filtering. The remaining signal reflects the population activity of a large number of cells in the vicinity of the probe, primarily through the electrical field effects of synaptic currents (along with other trans-membrane currents).</p>
<p>LFP can be especially informative for understanding rhythmic activity or oscillations in neural circuits, which can be identified by some simple time-series analysis of the LFP signals.</p>
<p>:::{admonition} Example: Accessing LFP data
We’ll start by loading the LFP data from one of the probes in our session, using the <code class="docutils literal notranslate"><span class="pre">get_lfp</span></code> function.</p>
<p>We need to provide this function with a probe id, which we can pull out of the <code class="docutils literal notranslate"><span class="pre">session.probes</span></code> table.</p>
<p>(Note that the “id” column is the index of the dataframe, and thus must be accessed differently than other columns.)
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">probe_id</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">probes</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lfp</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_lfp</span><span class="p">(</span><span class="n">probe_id</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lfp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xarray.DataArray &#39;LFP&#39; (time: 12183127, channel: 89)&gt;
array([[ 1.94999993e-05,  1.52100001e-05,  1.63799996e-05, ...,
         1.94999998e-07,  4.68000007e-06,  6.43500016e-06],
       [ 2.28150002e-05,  5.84999998e-06, -1.20899995e-05, ...,
         8.58000021e-06,  1.20899995e-05,  1.65750007e-05],
       [-1.28700003e-05, -3.45150002e-05, -2.90549997e-05, ...,
        -1.75499997e-06,  1.30649996e-05,  7.60500006e-06],
       ...,
       [ 5.67450006e-05,  8.17050022e-05,  8.03399962e-05, ...,
         1.48199997e-05,  8.96999973e-06, -5.26499980e-06],
       [ 5.26500007e-05,  6.88349974e-05,  5.46000010e-05, ...,
         1.01400001e-05,  5.46000001e-06, -4.68000007e-06],
       [ 3.50999981e-05,  3.72450013e-05,  3.93900009e-05, ...,
         7.80000028e-06,  7.01999988e-06, -6.23999995e-06]], dtype=float32)
Coordinates:
  * time     (time) float64 3.788 3.788 3.789 ... 9.75e+03 9.75e+03 9.75e+03
  * channel  (channel) int64 850178710 850178718 ... 850179406 850179414
</pre></div>
</div>
</div>
</div>
<p>:::{admonition} Example: Plot the LFP data array
To visualize this data, we’ll first use the built-in xarray plotting to generate
a quick plot. This is too much data to plot all at once, so we select a subset
first. Just as in pandas, we use the <code class="docutils literal notranslate"><span class="pre">loc</span></code> property, but since xarray has named
dimensions, we can specify our selections by name rather than by order, using a
dict.</p>
<p>We’ll also add the structure boundaries to this plot, as we did with unit waveforms.
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">lfp_plot</span> <span class="o">=</span> <span class="n">lfp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">20</span><span class="p">))]</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lfp_plot</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lfp_plot</span><span class="o">.</span><span class="n">channel</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lfp_plot</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time (s)&quot;</span><span class="p">)</span>

<span class="c1"># include the structure data</span>
<span class="n">ecephys_structure_acronyms</span><span class="p">,</span> <span class="n">intervals</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">channel_structure_intervals</span><span class="p">(</span><span class="n">lfp</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">intervals</span><span class="p">)</span>
<span class="n">interval_midpoints</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">aa</span> <span class="o">+</span> <span class="n">bb</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">aa</span><span class="p">,</span> <span class="n">bb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">intervals</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">intervals</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">interval_midpoints</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ecephys_structure_acronyms</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/vcnp_169_0.png" src="../_images/vcnp_169_0.png" />
</div>
</div>
<p>:::{admonition} Example: Plot and filter single-channel LFP timeseries
Let’s look at the low frequency potentials (LFP) for these data.
:::</p>
<p>We’ll start by plotting the timeseries of a single channel.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">channel</span> <span class="o">=</span> <span class="n">lfp</span><span class="o">.</span><span class="n">channel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lfp_subset</span> <span class="o">=</span> <span class="n">lfp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="n">channel</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">20</span><span class="p">))]</span>

<span class="c1"># you might then want to clear the full LFP from memory if not using it</span>
<span class="c1"># lfp = None</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">lfp_subset</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/vcnp_171_0.png" src="../_images/vcnp_171_0.png" />
</div>
</div>
<p>We might also want to visualize a specific frequency band by filtering. To do this we’ll want to convert our data into standard numpy arrays for easier processing using the DataArray object’s <code class="docutils literal notranslate"><span class="pre">values</span></code> property.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">lfp_subset</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">lfp_subset</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.signal</span>
<span class="n">freq_window</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">filt_order</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span><span class="n">filt_order</span><span class="p">,</span> <span class="n">freq_window</span><span class="p">,</span> <span class="n">btype</span><span class="o">=</span><span class="s1">&#39;bandpass&#39;</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<span class="n">v_alpha</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">lfilter</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">v_alpha</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7fe849a97790&gt;]
</pre></div>
</div>
<img alt="../_images/vcnp_174_1.png" src="../_images/vcnp_174_1.png" />
</div>
</div>
<p>:::{admonition} Example: LFP Power spectral density (PSD)
Next we’re going to analyze some spectral properties of this signal using the
<code class="docutils literal notranslate"><span class="pre">scipy.signal</span></code> library. “Spectral” refers to decomposing a signal into a sum of
simpler components identified by their frequencies. The set of frequencies of
the components forms a <em>spectrum</em> that tells us about the complete signal. You
can see a full list of spectral analysis functions in scipy here:
https://docs.scipy.org/doc/scipy/reference/signal.html#spectral-analysis
:::</p>
<p>We first import the package, and inspect the <code class="docutils literal notranslate"><span class="pre">periodogram</span></code> function, which estimates the size of the different frequency components of the signal.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.signal</span>
<span class="n">help</span><span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">periodogram</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Help on function periodogram in module scipy.signal._spectral_py:

periodogram(x, fs=1.0, window=&#39;boxcar&#39;, nfft=None, detrend=&#39;constant&#39;, return_onesided=True, scaling=&#39;density&#39;, axis=-1)
    Estimate power spectral density using a periodogram.
    
    Parameters
    ----------
    x : array_like
        Time series of measurement values
    fs : float, optional
        Sampling frequency of the `x` time series. Defaults to 1.0.
    window : str or tuple or array_like, optional
        Desired window to use. If `window` is a string or tuple, it is
        passed to `get_window` to generate the window values, which are
        DFT-even by default. See `get_window` for a list of windows and
        required parameters. If `window` is array_like it will be used
        directly as the window and its length must be nperseg. Defaults
        to &#39;boxcar&#39;.
    nfft : int, optional
        Length of the FFT used. If `None` the length of `x` will be
        used.
    detrend : str or function or `False`, optional
        Specifies how to detrend each segment. If `detrend` is a
        string, it is passed as the `type` argument to the `detrend`
        function. If it is a function, it takes a segment and returns a
        detrended segment. If `detrend` is `False`, no detrending is
        done. Defaults to &#39;constant&#39;.
    return_onesided : bool, optional
        If `True`, return a one-sided spectrum for real data. If
        `False` return a two-sided spectrum. Defaults to `True`, but for
        complex data, a two-sided spectrum is always returned.
    scaling : { &#39;density&#39;, &#39;spectrum&#39; }, optional
        Selects between computing the power spectral density (&#39;density&#39;)
        where `Pxx` has units of V**2/Hz and computing the power
        spectrum (&#39;spectrum&#39;) where `Pxx` has units of V**2, if `x`
        is measured in V and `fs` is measured in Hz. Defaults to
        &#39;density&#39;
    axis : int, optional
        Axis along which the periodogram is computed; the default is
        over the last axis (i.e. ``axis=-1``).
    
    Returns
    -------
    f : ndarray
        Array of sample frequencies.
    Pxx : ndarray
        Power spectral density or power spectrum of `x`.
    
    Notes
    -----
    .. versionadded:: 0.12.0
    
    See Also
    --------
    welch: Estimate power spectral density using Welch&#39;s method
    lombscargle: Lomb-Scargle periodogram for unevenly sampled data
    
    Examples
    --------
    &gt;&gt;&gt; from scipy import signal
    &gt;&gt;&gt; import matplotlib.pyplot as plt
    &gt;&gt;&gt; rng = np.random.default_rng()
    
    Generate a test signal, a 2 Vrms sine wave at 1234 Hz, corrupted by
    0.001 V**2/Hz of white noise sampled at 10 kHz.
    
    &gt;&gt;&gt; fs = 10e3
    &gt;&gt;&gt; N = 1e5
    &gt;&gt;&gt; amp = 2*np.sqrt(2)
    &gt;&gt;&gt; freq = 1234.0
    &gt;&gt;&gt; noise_power = 0.001 * fs / 2
    &gt;&gt;&gt; time = np.arange(N) / fs
    &gt;&gt;&gt; x = amp*np.sin(2*np.pi*freq*time)
    &gt;&gt;&gt; x += rng.normal(scale=np.sqrt(noise_power), size=time.shape)
    
    Compute and plot the power spectral density.
    
    &gt;&gt;&gt; f, Pxx_den = signal.periodogram(x, fs)
    &gt;&gt;&gt; plt.semilogy(f, Pxx_den)
    &gt;&gt;&gt; plt.ylim([1e-7, 1e2])
    &gt;&gt;&gt; plt.xlabel(&#39;frequency [Hz]&#39;)
    &gt;&gt;&gt; plt.ylabel(&#39;PSD [V**2/Hz]&#39;)
    &gt;&gt;&gt; plt.show()
    
    If we average the last half of the spectral density, to exclude the
    peak, we can recover the noise power on the signal.
    
    &gt;&gt;&gt; np.mean(Pxx_den[25000:])
    0.000985320699252543
    
    Now compute and plot the power spectrum.
    
    &gt;&gt;&gt; f, Pxx_spec = signal.periodogram(x, fs, &#39;flattop&#39;, scaling=&#39;spectrum&#39;)
    &gt;&gt;&gt; plt.figure()
    &gt;&gt;&gt; plt.semilogy(f, np.sqrt(Pxx_spec))
    &gt;&gt;&gt; plt.ylim([1e-4, 1e1])
    &gt;&gt;&gt; plt.xlabel(&#39;frequency [Hz]&#39;)
    &gt;&gt;&gt; plt.ylabel(&#39;Linear spectrum [V RMS]&#39;)
    &gt;&gt;&gt; plt.show()
    
    The peak height in the power spectrum is an estimate of the RMS
    amplitude.
    
    &gt;&gt;&gt; np.sqrt(Pxx_spec.max())
    2.0077340678640727
</pre></div>
</div>
</div>
</div>
<p>There are a number of options that we won’t go into here for refining the analysis. The one piece of information we do need is <code class="docutils literal notranslate"><span class="pre">fs</span></code>, the sampling frequency. If we used the default value <code class="docutils literal notranslate"><span class="pre">fs=1.0</span></code> our results would not match the true frequencies of the signal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fs</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">f</span><span class="p">,</span> <span class="n">psd</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">periodogram</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We’ll plot the power spectrum on a semilog plot, since power can vary over many orders of magnitude across frequencies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">psd</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Power ($uV^</span><span class="si">{2}</span><span class="s1">/Hz$)&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/vcnp_180_0.png" src="../_images/vcnp_180_0.png" />
</div>
</div>
<p>We see that this representation of the power spectrum is extremely noisy. Luckily, many people have come up with solutions to this problem. Scipy includes a function for Welch’s method, which averages out noise by computing many estimates of the power spectrum from overlapping windows of the data. You can find some more references for this approach in the Scipy documentation: https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.welch.html#scipy.signal.welch</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">psd</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">welch</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">psd</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Power ($uV^</span><span class="si">{2}</span><span class="s1">/Hz$)&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/vcnp_182_0.png" src="../_images/vcnp_182_0.png" />
</div>
</div>
<p>:::{admonition} Example: Calculate and plot the time-frequency profile (“spectrogram”)
We might also be interested in how the frequency content of the signal varies
over time. In a neural context, power in different frequency bands is often
linked to specific types of processing, so we might explore whether changes in
the spectrum coincide with specific behaviors or stimuli.</p>
<p>The <em>spectrogram</em> is essentially an estimate of the power spectrum computed in a
sliding time window, producing a 2D representation of the signal power across
frequency and time.
:::</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">t_spec</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">spectrogram</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="s1">&#39;hanning&#39;</span><span class="p">,</span>
                            <span class="n">nperseg</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">noverlap</span><span class="o">=</span><span class="mi">1000</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;psd&#39;</span><span class="p">)</span>
<span class="c1"># Scipy assumes our signal starts at time=0, so we need to provide the offset</span>
<span class="n">t_spec</span> <span class="o">=</span> <span class="n">t_spec</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="nn">~/opt/anaconda3/lib/python3.9/site-packages/scipy/signal/windows/_windows.py</span> in <span class="ni">get_window</span><span class="nt">(window, Nx, fftbins)</span>
<span class="g g-Whitespace">   </span><span class="mi">2213</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2214</span>         <span class="n">beta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2215</span>     <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="ne">ValueError</span>: could not convert string to float: &#39;hanning&#39;

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="nn">~/opt/anaconda3/lib/python3.9/site-packages/scipy/signal/windows/_windows.py</span> in <span class="ni">get_window</span><span class="nt">(window, Nx, fftbins)</span>
<span class="g g-Whitespace">   </span><span class="mi">2231</span>         <span class="k">try</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2232</span>             <span class="n">winfunc</span> <span class="o">=</span> <span class="n">_win_equiv</span><span class="p">[</span><span class="n">winstr</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">2233</span>         <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="ne">KeyError</span>: &#39;hanning&#39;

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">qh</span><span class="o">/</span><span class="mi">5</span><span class="n">lyvn7d93mzft9kchq7xsqkw0000gp</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_93794</span><span class="o">/</span><span class="mf">2010518480.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">f</span><span class="p">,</span> <span class="n">t_spec</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">spectrogram</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="s1">&#39;hanning&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>                             <span class="n">nperseg</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">noverlap</span><span class="o">=</span><span class="mi">1000</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;psd&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="c1"># Scipy assumes our signal starts at time=0, so we need to provide the offset</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">t_spec</span> <span class="o">=</span> <span class="n">t_spec</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="nn">~/opt/anaconda3/lib/python3.9/site-packages/scipy/signal/_spectral_py.py</span> in <span class="ni">spectrogram</span><span class="nt">(x, fs, window, nperseg, noverlap, nfft, detrend, return_onesided, scaling, axis, mode)</span>
<span class="g g-Whitespace">    </span><span class="mi">742</span> 
<span class="g g-Whitespace">    </span><span class="mi">743</span>     <span class="c1"># need to set default for nperseg before setting default for noverlap below</span>
<span class="ne">--&gt; </span><span class="mi">744</span>     <span class="n">window</span><span class="p">,</span> <span class="n">nperseg</span> <span class="o">=</span> <span class="n">_triage_segments</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">nperseg</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">745</span>                                        <span class="n">input_length</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">])</span>
<span class="g g-Whitespace">    </span><span class="mi">746</span> 

<span class="nn">~/opt/anaconda3/lib/python3.9/site-packages/scipy/signal/_spectral_py.py</span> in <span class="ni">_triage_segments</span><span class="nt">(window, nperseg, input_length)</span>
<span class="g g-Whitespace">   </span><span class="mi">2001</span>                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nperseg</span><span class="p">,</span> <span class="n">input_length</span><span class="p">))</span>
<span class="g g-Whitespace">   </span><span class="mi">2002</span>             <span class="n">nperseg</span> <span class="o">=</span> <span class="n">input_length</span>
<span class="ne">-&gt; </span><span class="mi">2003</span>         <span class="n">win</span> <span class="o">=</span> <span class="n">get_window</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">nperseg</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2004</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2005</span>         <span class="n">win</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

<span class="nn">~/opt/anaconda3/lib/python3.9/site-packages/scipy/signal/windows/_windows.py</span> in <span class="ni">get_window</span><span class="nt">(window, Nx, fftbins)</span>
<span class="g g-Whitespace">   </span><span class="mi">2232</span>             <span class="n">winfunc</span> <span class="o">=</span> <span class="n">_win_equiv</span><span class="p">[</span><span class="n">winstr</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">2233</span>         <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2234</span>             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown window type.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
<span class="g g-Whitespace">   </span><span class="mi">2235</span> 
<span class="g g-Whitespace">   </span><span class="mi">2236</span>         <span class="k">if</span> <span class="n">winfunc</span> <span class="ow">is</span> <span class="n">dpss</span><span class="p">:</span>

<span class="ne">ValueError</span>: Unknown window type.
</pre></div>
</div>
</div>
</div>
<p>We’ll use the matplotlib <code class="docutils literal notranslate"><span class="pre">pcolormesh</span></code> function to visualize this data as an image. We can pass this function x and y coordinates to get the axis labeling right. We also log-transform the power spectrum and restrict to frequencies less than 100 Hz.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fmax</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">t_spec</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">f</span><span class="o">&lt;</span><span class="n">fmax</span><span class="p">]</span>
<span class="n">plot_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="n">f</span><span class="o">&lt;</span><span class="n">fmax</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>We’ll plot the spectrum together with the raw signal in subplots. Note that we explicitly set the x-axis limits to align the plots. (Alternatively, it’s possible to directly couple the limits of different subplots.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">plot_data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">)</span>
<span class="n">window</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">20</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Voltage (a.u.)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="other-resources">
<h2>Other resources<a class="headerlink" href="#other-resources" title="Permalink to this headline">#</a></h2>
<p>These data and the AllenSDK have been documented many times in many places. Here
are some other resource:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://portal.brain-map.org/explore/circuits/visual-coding-neuropixels">brain-map.org</a></p>
<ul>
<li><p>Of particular note is the
<a class="reference external" href="https://brainmapportal-live-4cc80a57cd6e400d854-f7fdcae.divio-media.net/filer_public/0f/5d/0f5d22c9-f8f6-428c-9f7a-2983631e72b4/neuropixels_cheat_sheet_nov_2019.pdf">cheat sheet</a>
from brain-map.org</p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://allensdk.readthedocs.io/en/latest/visual_coding_neuropixels.html">Allen SDK documentation</a></p>
<ul>
<li><p>The <a class="reference external" href="https://allensdk.readthedocs.io/en/latest/allensdk.brain_observatory.ecephys.html">API documentation of Allen SDK</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://github.com/AllenInstitute/swdb_2022/blob/main/DynamicBrain/Visual_Coding_materials/Visual_Coding_Neuropixels_SWDB_2019.ipynb">Notebooks from previous SWDBs</a></p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./visual-coding-np"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../visual-coding-2p/vc2p-cross-session-data.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Cross session data</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../glossary.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Glossary</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Saskia de Vries, Marina Garrett, Corbett Bennet, Galen Lynch, Anna Lakunina, Casey Schneider-Mizell<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>